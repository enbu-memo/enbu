<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QLBFCRRHD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0QLBFCRRHD');
</script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name=”description” content=”戦国炎舞の攻略サイト” />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>戦国炎舞の備忘録</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
</head>
<body>
    <div id="header-include"></div>
    <script>
        // header.htmlを読み込んで挿入し、ヘッダー内のスクリプトも再実行
        fetch('header.html')
            .then(res => res.text())
            .then(data => {
                const headerDiv = document.getElementById('header-include');
                headerDiv.innerHTML = data;
                // ヘッダー内のスクリプトを再実行
                const scripts = headerDiv.querySelectorAll('script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.body.appendChild(newScript);
                });
            });
            fetch('copyright.html')
                .then(res => res.text())
                .then(data => {
                    const el = document.getElementById('copyright-include');
                    if (el) el.innerHTML = data;
                });
    </script>
    <div class="container">
        <div class="last-update">最終更新日: 2026年1月30日</div>
        <main>
            <!-- <section>
                <h2>イベントカレンダー</h2>
                <div id="calendar"></div>
            </section> -->
            <section>
                <h2>更新履歴</h2>
                <label for="filterInput"> </label>
                <input type="text" id="filterInput" placeholder="ページで絞り込み">
                <div class="table-scroll">
                    <table id="historyTable">
                        <thead>
                            <tr>
                                <th>ページ</th>
                                <th>
                                    更新日
                                    <button id="sortToggle" title="ソート">▼</button>
                                </th>
                                <th>更新内容</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ALL</td>
                                <td data-date="2025-11-17">2025/11/17</td>
                                <td>開設</td>
                            </tr>
                            <tr>
                                <td><a href="skillroot.html" style="text-decoration:underline;color:#1976d2;">スキル玉合成</a></td>
                                <td data-date="2025-11-19">2025/11/19</td>
                                <td>開設</td>
                            </tr>
                            <tr>
                                <td><a href="skillroot.html" style="text-decoration:underline;color:#1976d2;">スキル玉合成</a></td>
                                <td data-date="2025-11-20">2025/11/20</td>
                                <td>更新</td>
                            </tr>
                            <tr>
                                <td><a href="skillroot.html" style="text-decoration:underline;color:#1976d2;">スキル玉合成</a></td>
                                <td data-date="2025-11-21">2025/11/21</td>
                                <td>更新</td>
                            </tr>
                            <tr>
                                <td><a href="skillroot.html" style="text-decoration:underline;color:#1976d2;">スキル玉合成</a></td>
                                <td data-date="2025-11-22">2025/11/22</td>
                                <td>更新</td>
                            </tr>
                            <tr>
                                <td><a href="deck-raid.html" style="text-decoration:underline;color:#1976d2;">デッキ-レイド</a></td>
                                <td data-date="2025-11-23">2025/11/23</td>
                                <td>開設</td>
                            </tr>
                            <tr>
                                <td><a href="skillroot.html" style="text-decoration:underline;color:#1976d2;">スキル玉合成</a></td>
                                <td data-date="2025-11-27">2025/11/27</td>
                                <td>更新</td>
                            </tr>
                            <tr>
                                <td><a href="data-skill.html" style="text-decoration:underline;color:#1976d2;">データ-スキル</a></td>
                                <td data-date="2025-12-4">2025/12/4</td>
                                <td>更新</td>
                            </tr>
                             <tr>
                                <td><a href="review-raid.html" style="text-decoration:underline;color:#1976d2;">大将-レイド</a></td>
                                <td data-date="2025-12-4">2025/12/4</td>
                                <td>更新</td>
                             </tr>
                              <tr>
                                <td><a href="review-kassen.html" style="text-decoration:underline;color:#1976d2;">大将-合戦</a></td>
                                <td data-date="2025-12-4">2025/12/4</td>
                                <td>更新</td>
                             </tr>
                              <tr>
                                <td><a href="event-1st.html" style="text-decoration:underline;color:#1976d2;">交換所-1st</a></td>
                                <td data-date="2025-12-6">2025/12/6</td>
                                <td>開設</td>
                             </tr>
                            <tr>
                                <td><a href="data-skill.html" style="text-decoration:underline;color:#1976d2;">データ-スキル</a></td>
                                <td data-date="2025-12-6">2025/12/6</td>
                                <td>更新</td>
                            </tr>
                            <tr>
                                <td><a href="data-ougi.html" style="text-decoration:underline;color:#1976d2;">データ-奥義</a></td>
                                <td data-date="2025-12-6">2025/12/6</td>
                                <td>更新</td>
                            </tr>
                            <tr>
                                <td><a href="review-kassen.html" style="text-decoration:underline;color:#1976d2;">大将-合戦</a></td>
                                <td data-date="2025-12-17">2025/12/17</td>
                                <td>更新</td>
                            </tr>
                             <tr>
                                <td><a href="review-raid.html" style="text-decoration:underline;color:#1976d2;">大将-レイド</a></td>
                                <td data-date="2025-12-17">2025/12/17</td>
                                <td>更新</td>
                             </tr>    
                              <tr>
                                <td><a href="event-1st.html" style="text-decoration:underline;color:#1976d2;">交換所-1st</a></td>
                                <td data-date="2025-12-18">2025/12/18</td>
                                <td>更新</td>
                             </tr>   
                              <tr>
                                <td><a href="event-raid-12.html" style="text-decoration:underline;color:#1976d2;">レイド-12月</a></td>
                                <td data-date="2025-12-20">2025/12/20</td>
                                <td>開設</td>
                             </tr>     
                              <tr>
                                <td><a href="serialcode.html" style="text-decoration:underline;color:#1976d2;">シリアルコード</a></td>
                                <td data-date="2026-1-6">2026/1/6</td>
                                <td>開設</td>
                             </tr>   
                            <tr>
                                <td><a href="data-skill.html" style="text-decoration:underline;color:#1976d2;">データ-スキル</a></td>
                                <td data-date="2026-1-6">2026/1/6</td>
                                <td>更新</td>
                            </tr>
                            <tr>
                                <td><a href="review-kassen.html" style="text-decoration:underline;color:#1976d2;">大将-合戦</a></td>
                                <td data-date="2026-1-6">2026/1/6</td>
                                <td>更新</td>
                            </tr>
                             <tr>
                                <td><a href="review-raid.html" style="text-decoration:underline;color:#1976d2;">大将-レイド</a></td>
                                <td data-date="2026-1-6">2026/1/6</td>
                                <td>更新</td>
                             </tr>  
                            <tr>
                                <td><a href="review-kassen.html" style="text-decoration:underline;color:#1976d2;">大将-合戦</a></td>
                                <td data-date="2026-1-30">2026/1/30</td>
                                <td>更新</td>
                            </tr>
                             <tr>
                                <td><a href="review-raid.html" style="text-decoration:underline;color:#1976d2;">大将-レイド</a></td>
                                <td data-date="2026-1-30">2026/1/30</td>
                                <td>更新</td>
                             </tr>
                            <tr>
                                <td><a href="review-tensho.html" style="text-decoration:underline;color:#1976d2;">武将-天将</a></td>
                                <td data-date="2026-1-30">2026/1/30</td>
                                <td>更新</td>
                             </tr>
                            <tr>
                                <td><a href="review-haou.html" style="text-decoration:underline;color:#1976d2;">武将-覇王</a></td>
                                <td data-date="2026-1-30">2026/1/30</td>
                                <td>更新</td>
                             </tr>                                                                                                        
                            <!-- ここに行を追加しても5件を超えたらスクロールされます -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>
    <footer>
        <p>&copy; 2026 戦国炎舞の備忘録</p>
    </footer>
    <script>
        // 記事名のみフィルター
        const filterInput = document.getElementById('filterInput');
        const table = document.getElementById('historyTable');
        filterInput.addEventListener('keyup', function() {
            const filter = filterInput.value.toLowerCase();
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            for (let i = 0; i < rows.length; i++) {
                const titleCell = rows[i].getElementsByTagName('td')[0];
                const titleText = titleCell.textContent.toLowerCase();
                rows[i].style.display = titleText.includes(filter) ? '' : 'none';
            }
        });

        // 昇順・降順ソートのみ
    let sortAsc = false;
        const sortButton = document.getElementById('sortToggle');
        const tbody = table.getElementsByTagName('tbody')[0];

        function sortTableByDate(asc = true) {
            const rows = Array.from(tbody.getElementsByTagName('tr'));
            rows.sort((a, b) => {
                const dateA = a.getElementsByTagName('td')[1].getAttribute('data-date');
                const dateB = b.getElementsByTagName('td')[1].getAttribute('data-date');
                // 日付をDateオブジェクトに変換
                const dA = new Date(dateA.replace(/-/g, '/'));
                const dB = new Date(dateB.replace(/-/g, '/'));
                if (asc) {
                    return dA - dB;
                } else {
                    return dB - dA;
                }
            });
            rows.forEach(row => tbody.appendChild(row));
        }

    // 初期表示は最新順（降順）
    sortTableByDate(false);

        sortButton.addEventListener('click', function() {
            sortAsc = !sortAsc;
            sortTableByDate(sortAsc);
            sortButton.textContent = sortAsc ? '▲' : '▼';
        });
    </script>
    </div>
</body>
    <div id="copyright-include"></div>
    <button id="backToTop" title="一番上に戻る">↑</button>
    <!-- FullCalendar CDN（CSS・JS両方） -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script>
    // 一番上に戻るボタンの表示・動作
    const backToTop = document.getElementById('backToTop');
    window.addEventListener('scroll', function() {
        if (window.scrollY > 200) {
            backToTop.style.display = 'block';
        } else {
            backToTop.style.display = 'none';
        }
    });
    backToTop.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // FullCalendar初期化（イベントはevents.jsonから取得）
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        if (calendarEl) {
            fetch('events.json')
                .then(response => response.json())
                .then(events => {
                    let allEvents = events;
                    let calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: 'dayGridMonth',
                        locale: 'ja',
                        height: 'auto',
                        showNonCurrentDates: true,
                        events: function(fetchInfo, successCallback, failureCallback) {
                            // 表示中の月の開始・終了日
                            const startMonth = fetchInfo.start;
                            const endMonth = fetchInfo.end;
                            // 月内に収めたイベントリスト
                            let filtered = allEvents.map(ev => {
                                let evStart = new Date(ev.start);
                                let evEnd = new Date(ev.end);
                                // 月内に収める
                                let newStart = evStart < startMonth ? startMonth : evStart;
                                let newEnd = evEnd > endMonth ? endMonth : evEnd;
                                // 月内に1日でもかかっていれば表示
                                if (newEnd > newStart) {
                                    return {
                                        ...ev,
                                        start: newStart.toISOString().slice(0,10),
                                        end: newEnd.toISOString().slice(0,10)
                                    };
                                } else {
                                    return null;
                                }
                            }).filter(e => e);
                            successCallback(filtered);
                        }
                    });
                    calendar.render();
                });
        }
    });
    </script>
</html>
