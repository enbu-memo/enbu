<!DOCTYPE html>
<html lang="ja">
<head>
        <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>炎舞の備忘録-トップ</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
</head>
<body>
    <div id="header-include"></div>
    <script>
        // header.htmlを読み込んで挿入し、ヘッダー内のスクリプトも再実行
        fetch('header.html')
            .then(res => res.text())
            .then(data => {
                const headerDiv = document.getElementById('header-include');
                headerDiv.innerHTML = data;
                // ヘッダー内のスクリプトを再実行
                const scripts = headerDiv.querySelectorAll('script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.body.appendChild(newScript);
                });
            });
    </script>
    <div class="container">
        <div class="last-update">最終更新日: 2025年11月17日</div>
        <main>
            <section>
                <h2>イベントカレンダー</h2>
                <div id="calendar"></div>
            </section>
            <section>
                <hr class="section-divider">
                <h2>更新履歴</h2>
                <label for="filterInput"> </label>
                <input type="text" id="filterInput" placeholder="ページで絞り込み">
                <div class="table-scroll">
                    <table id="historyTable">
                        <thead>
                            <tr>
                                <th>ページ</th>
                                <th>
                                    更新日
                                    <button id="sortToggle" title="ソート">▼</button>
                                </th>
                                <th>更新内容</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ALL</td>
                                <td data-date="2025-11-17">2025/11/17</td>
                                <td>開設</td>
                            </tr>
                            <!-- ここに行を追加しても5件を超えたらスクロールされます -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>
    <footer>
        <p>&copy; 2025 炎舞の備忘録</p>
    </footer>
    <script>
        // 記事名のみフィルター
        const filterInput = document.getElementById('filterInput');
        const table = document.getElementById('historyTable');
        filterInput.addEventListener('keyup', function() {
            const filter = filterInput.value.toLowerCase();
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            for (let i = 0; i < rows.length; i++) {
                const titleCell = rows[i].getElementsByTagName('td')[0];
                const titleText = titleCell.textContent.toLowerCase();
                rows[i].style.display = titleText.includes(filter) ? '' : 'none';
            }
        });

        // 昇順・降順ソートのみ
    let sortAsc = false;
        const sortButton = document.getElementById('sortToggle');
        const tbody = table.getElementsByTagName('tbody')[0];

        function sortTableByDate(asc = true) {
            const rows = Array.from(tbody.getElementsByTagName('tr'));
            rows.sort((a, b) => {
                const dateA = a.getElementsByTagName('td')[1].getAttribute('data-date');
                const dateB = b.getElementsByTagName('td')[1].getAttribute('data-date');
                if (asc) {
                    return dateA.localeCompare(dateB);
                } else {
                    return dateB.localeCompare(dateA);
                }
            });
            rows.forEach(row => tbody.appendChild(row));
        }

    // 初期表示は最新順（降順）
    sortTableByDate(false);

        sortButton.addEventListener('click', function() {
            sortAsc = !sortAsc;
            sortTableByDate(sortAsc);
            sortButton.textContent = sortAsc ? '▲' : '▼';
        });
    </script>
    <button id="backToTop" title="一番上に戻る">↑</button>
</body>
    <!-- FullCalendar CDN（CSS・JS両方） -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script>
    // 一番上に戻るボタンの表示・動作
    const backToTop = document.getElementById('backToTop');
    window.addEventListener('scroll', function() {
        if (window.scrollY > 200) {
            backToTop.style.display = 'block';
        } else {
            backToTop.style.display = 'none';
        }
    });
    backToTop.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // FullCalendar初期化（イベントはevents.jsonから取得）
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        if (calendarEl) {
            fetch('events.json')
                .then(response => response.json())
                .then(events => {
                    let allEvents = events;
                    let calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: 'dayGridMonth',
                        locale: 'ja',
                        height: 'auto',
                        showNonCurrentDates: true,
                        events: function(fetchInfo, successCallback, failureCallback) {
                            // 表示中の月の開始・終了日
                            const startMonth = fetchInfo.start;
                            const endMonth = fetchInfo.end;
                            // 月内に収めたイベントリスト
                            let filtered = allEvents.map(ev => {
                                let evStart = new Date(ev.start);
                                let evEnd = new Date(ev.end);
                                // 月内に収める
                                let newStart = evStart < startMonth ? startMonth : evStart;
                                let newEnd = evEnd > endMonth ? endMonth : evEnd;
                                // 月内に1日でもかかっていれば表示
                                if (newEnd > newStart) {
                                    return {
                                        ...ev,
                                        start: newStart.toISOString().slice(0,10),
                                        end: newEnd.toISOString().slice(0,10)
                                    };
                                } else {
                                    return null;
                                }
                            }).filter(e => e);
                            successCallback(filtered);
                        }
                    });
                    calendar.render();
                });
        }
    });
    </script>
</html>
